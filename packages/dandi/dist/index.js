"use strict";(()=>{var M=Object.defineProperty;var U=(e,t)=>{for(var s in t)M(e,s,{get:t[s],enumerable:!0})};var R=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)};var i=(e,t,s)=>(R(e,t,"read from private field"),s?s.call(e):t.get(e)),a=(e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},o=(e,t,s,n)=>(R(e,t,"write to private field"),n?n.call(e,s):t.set(e,s),s);var D={};U(D,{API:()=>P,Asset:()=>B,Dandiset:()=>_,get:()=>L,getAll:()=>G,getAsset:()=>b,getAssets:()=>N,getAssetsUrl:()=>J,utils:()=>V});var V={};U(V,{getBase:()=>l,getInfo:()=>k,getInfoURL:()=>u,getInstance:()=>y,getJSON:()=>c,getLatestVersion:()=>A,getURL:()=>x,paginate:()=>m});var C={main:"api.dandiarchive.org",staging:"api-staging.dandiarchive.org"},$=C;var A=async(e,t)=>{let s=await l(e,t);if(s){let n=s.most_recent_published_version?.version;if(n)return n;if(s.draft_version?.status==="Valid")return s.draft_version?.version}else return null},y=e=>typeof e=="string"?$[e]:$.main,x=(e,t)=>new URL(e,`https://${y(t)}/api/`),c=e=>fetch(e).then(t=>t.json()),S=(e,t)=>`https://${y(t)}/api/dandisets/${e}`,l=(e,t)=>c(S(e,t)),u=(e,t={})=>`${S(e,t.type)}/versions/${t?.version?t.version:"draft"}`,k=async(e,t={})=>{let s=t.version??await A(e,t.type);if(s)return c(u(e,{...t,version:s}))},m=async e=>{let t=[];if(e.results&&t.push(...e.results),e.next){let s=await c(e.next);t.push(...await m(s))}return t};var h,g,v,B=class{constructor(t,s,n="main"){a(this,h,void 0);a(this,g,void 0);a(this,v,t=>{Object.assign(this,t),this.asset_id=t.asset_id});s&&typeof s=="object"&&!(s instanceof String)?i(this,v).call(this,s):this.asset_id=s,o(this,h,n),o(this,g,t)}async get(t=i(this,g),s=this.asset_id,n=i(this,h)){o(this,g,t),o(this,h,n),this.asset_id=s;let r=await b(i(this,g),this.asset_id,i(this,h));return r&&Object.assign(this,r),r}};h=new WeakMap,g=new WeakMap,v=new WeakMap;var b=async(e,t,s={})=>{let n=u(e,s),r=await c(`${n}/assets/${t}/info`);return new B(e,r,s.type)};var O,f,d,w,p,z,_=class{constructor(t,s){a(this,O,{});a(this,f,{});a(this,d,{});a(this,w,!1);a(this,p,{});a(this,z,t=>{o(this,O,t),Object.assign(this,t),this.identifier=t.identifier});let n=t&&typeof t=="object"&&!(t instanceof String);n&&i(this,z).call(this,t),this.identifier=n?t.identifier:t,o(this,p,s)}async get(t=this.identifier){if(t!==this.identifier){this.identifier=t,o(this,f,{}),o(this,d,{});let s=await l(this.identifier,i(this,p).type);s&&Object.assign(this,s)}return i(this,O)}async getInfo(t=i(this,p)){return Object.keys(i(this,f)).length===0&&o(this,f,await k(this.identifier,t)),i(this,f)}async getAsset(t,s=i(this,p)){return i(this,d)[t]||(i(this,d)[t]=await b(this.identifier,t,s)),i(this,d)[t]}async getAssets(t=i(this,p)){if(!i(this,w)){let s=await N(this.identifier,t);console.log("Got assets",s),s?.forEach(n=>i(this,d)[n.asset_id]=n),o(this,w,!0)}return i(this,d)}};O=new WeakMap,f=new WeakMap,d=new WeakMap,w=new WeakMap,p=new WeakMap,z=new WeakMap;var J=(e,t={})=>`${u(e,t)}/assets`,N=async(e,t={})=>{let s=t?.version??await A(e,t.type);if(s){let n=`${J(e,{...t,version:s})}`,r=await c(n);return await Promise.all((await m(r)).map(async j=>b(e,j.asset_id,t)))}},G=async e=>{let t=`https://${y(e.type)}/api/dandisets`,s=await c(t);return(await m(s)).map(r=>new _(r,e))},L=async(e,t)=>{let s=await l(e,t.type);return s?new _(s,t):null};var T,I,P=class{constructor({token:t,type:s="main"}){this.authorized=!1;this.init=async()=>{await this.authorize()};a(this,T,()=>{if(!this.authorized)throw new Error("API is not authorized. Please provide a valid token.")});this.get=async(t,s={})=>L(t,{...s,...this});this.create=async(t,s={},n=!1)=>{i(this,T).call(this);let r=x(`dandisets/?embargo=${n}`,this.type),j=JSON.stringify({name:t,metadata:s});return await fetch(r,{method:"POST",headers:i(this,I).call(this),body:j}).then(E=>E.json())};a(this,I,(t=this.token)=>({Authorization:`token ${t}`,accept:"application/json","Content-Type":"application/json"}));this.authorize=async(t=this.token)=>{await fetch(x("auth/token",this.type),{headers:i(this,I).call(this,t)}).catch(s=>{throw this.authorized=!1,s}),this.token=t,this.authorized=!0};this.token=t,this.type=s}};T=new WeakMap,I=new WeakMap;typeof globalThis.dandi<"u"?Object.assign(globalThis.dandi,D):globalThis.dandi=D;})();
//# sourceMappingURL=index.js.map
