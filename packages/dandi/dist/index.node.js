"use strict";var j=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var U=(e,t)=>{for(var s in t)j(e,s,{get:t[s],enumerable:!0})},H=(e,t,s,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of C(t))!G.call(e,a)&&a!==s&&j(e,a,{get:()=>t[a],enumerable:!(i=M(t,a))||i.enumerable});return e};var q=e=>H(j({},"__esModule",{value:!0}),e);var R=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)};var n=(e,t,s)=>(R(e,t,"read from private field"),s?s.call(e):t.get(e)),r=(e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},o=(e,t,s,i)=>(R(e,t,"write to private field"),i?i.call(e,s):t.set(e,s),s);var Q={};U(Q,{API:()=>P,Asset:()=>v,Dandiset:()=>b,get:()=>L,getAll:()=>K,getAsset:()=>_,getAssets:()=>N,getAssetsUrl:()=>J,utils:()=>V});module.exports=q(Q);var V={};U(V,{getBase:()=>l,getInfo:()=>k,getInfoURL:()=>u,getInstance:()=>y,getJSON:()=>c,getLatestVersion:()=>A,getURL:()=>B,paginate:()=>m});var F={main:"api.dandiarchive.org",staging:"api-staging.dandiarchive.org"},$=F;var A=async(e,t)=>{let s=await l(e,t);if(s){let i=s.most_recent_published_version?.version;if(i)return i;if(s.draft_version?.status==="Valid")return s.draft_version?.version}else return null},y=e=>typeof e=="string"?$[e]:$.main,B=(e,t)=>new URL(e,`https://${y(t)}/api/`),c=e=>fetch(e).then(t=>t.json()),S=(e,t)=>`https://${y(t)}/api/dandisets/${e}`,l=(e,t)=>c(S(e,t)),u=(e,t={})=>`${S(e,t.type)}/versions/${t?.version?t.version:"draft"}`,k=async(e,t={})=>{let s=t.version??await A(e,t.type);if(s)return c(u(e,{...t,version:s}))},m=async e=>{let t=[];if(e.results&&t.push(...e.results),e.next){let s=await c(e.next);t.push(...await m(s))}return t};var h,g,x,v=class{constructor(t,s,i="main"){r(this,h,void 0);r(this,g,void 0);r(this,x,t=>{Object.assign(this,t),this.asset_id=t.asset_id});s&&typeof s=="object"&&!(s instanceof String)?n(this,x).call(this,s):this.asset_id=s,o(this,h,i),o(this,g,t)}async get(t=n(this,g),s=this.asset_id,i=n(this,h)){o(this,g,t),o(this,h,i),this.asset_id=s;let a=await _(n(this,g),this.asset_id,n(this,h));return a&&Object.assign(this,a),a}};h=new WeakMap,g=new WeakMap,x=new WeakMap;var _=async(e,t,s={})=>{let i=u(e,s),a=await c(`${i}/assets/${t}/info`);return new v(e,a,s.type)};var O,f,p,w,d,z,b=class{constructor(t,s){r(this,O,{});r(this,f,{});r(this,p,{});r(this,w,!1);r(this,d,{});r(this,z,t=>{o(this,O,t),Object.assign(this,t),this.identifier=t.identifier});let i=t&&typeof t=="object"&&!(t instanceof String);i&&n(this,z).call(this,t),this.identifier=i?t.identifier:t,o(this,d,s)}async get(t=this.identifier){if(t!==this.identifier){this.identifier=t,o(this,f,{}),o(this,p,{});let s=await l(this.identifier,n(this,d).type);s&&Object.assign(this,s)}return n(this,O)}async getInfo(t=n(this,d)){return Object.keys(n(this,f)).length===0&&o(this,f,await k(this.identifier,t)),n(this,f)}async getAsset(t,s=n(this,d)){return n(this,p)[t]||(n(this,p)[t]=await _(this.identifier,t,s)),n(this,p)[t]}async getAssets(t=n(this,d)){if(!n(this,w)){let s=await N(this.identifier,t);console.log("Got assets",s),s?.forEach(i=>n(this,p)[i.asset_id]=i),o(this,w,!0)}return n(this,p)}};O=new WeakMap,f=new WeakMap,p=new WeakMap,w=new WeakMap,d=new WeakMap,z=new WeakMap;var J=(e,t={})=>`${u(e,t)}/assets`,N=async(e,t={})=>{let s=t?.version??await A(e,t.type);if(s){let i=`${J(e,{...t,version:s})}`,a=await c(i);return await Promise.all((await m(a)).map(async T=>_(e,T.asset_id,t)))}},K=async e=>{let t=`https://${y(e.type)}/api/dandisets`,s=await c(t);return(await m(s)).map(a=>new b(a,e))},L=async(e,t)=>{let s=await l(e,t.type);return s?new b(s,t):null};var D,I,P=class{constructor({token:t,type:s="main"}){this.authorized=!1;this.init=async()=>{await this.authorize()};r(this,D,()=>{if(!this.authorized)throw new Error("API is not authorized. Please provide a valid token.")});this.get=async(t,s={})=>L(t,{...s,...this});this.create=async(t,s={},i=!1)=>{n(this,D).call(this);let a=B(`dandisets/?embargo=${i}`,this.type),T=JSON.stringify({name:t,metadata:s});return await fetch(a,{method:"POST",headers:n(this,I).call(this),body:T}).then(E=>E.json())};r(this,I,(t=this.token)=>({Authorization:`token ${t}`,accept:"application/json","Content-Type":"application/json"}));this.authorize=async(t=this.token)=>{await fetch(B("auth/token",this.type),{headers:n(this,I).call(this,t)}).catch(s=>{throw this.authorized=!1,s}),this.token=t,this.authorized=!0};this.token=t,this.type=s}};D=new WeakMap,I=new WeakMap;0&&(module.exports={API,Asset,Dandiset,get,getAll,getAsset,getAssets,getAssetsUrl,utils});
//# sourceMappingURL=index.node.js.map
