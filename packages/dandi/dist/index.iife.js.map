{
  "version": 3,
  "sources": ["../src/utils.ts", "../src/instances.ts", "../src/Asset.ts", "../src/Dandiset.ts", "../src/index.ts"],
  "sourcesContent": ["import instances from \"./instances\"\nimport { InstanceType, Options } from \"./types\"\n\nexport const getLatestVersion = async (id: string, instance?: InstanceType) => {\n    const base = await getBase(id, instance)\n\n    if (base){\n        const recent = base.most_recent_published_version?.version\n        if (recent) return recent\n\n        const isValidDraft = base.draft_version?.status === 'Valid'\n        if (isValidDraft) return base.draft_version?.version\n    } else return null\n}\n\nexport const getInstance = (instance?: InstanceType) => typeof instance === 'string' ? instances[instance] : instances.main\n\nexport const getURL = (path: string, instanceType?: InstanceType) => new URL(path, `https://${getInstance(instanceType)}/api/`)\n\n\nexport const getJSON = (url: string) => fetch(url).then(res => res.json())\n\nconst getBaseURL = (id: string, instance?: InstanceType) => `https://${getInstance(instance)}/api/dandisets/${id}`\n\nexport const getBase = (id: string, instance?: InstanceType) => getJSON(getBaseURL(id, instance))\n\nexport const getInfoURL = (id: string, options: Options = {}) => `${getBaseURL(id, options.type)}/versions/${options?.version ? options.version : 'draft'}`\n\nexport const getInfo = async (id: string, options: Options = {}) => {\n  const version = options.version ?? await getLatestVersion(id, options.type)\n  if (version) return getJSON(getInfoURL(id, {...options, version}))\n}\n\n\nexport const paginate = async (o: any) : Promise<any[]> => {\n\n    const results = []\n  \n    if (o.results) results.push(...o.results)\n  \n    if (o.next) {\n      const info = await getJSON(o.next)\n      results.push(...await paginate(info))\n    }\n    \n    return results\n  }", "const instances = {\n    main: `api.dandiarchive.org`,\n    staging:  `api-staging.dandiarchive.org`\n}\n\nexport default instances", "import { InstanceType, Options } from \"./types\"\nimport { getInfoURL, getJSON } from \"./utils\"\n\ntype AssetBase = {\n    asset_id: string\n    blob: string\n    created: string\n    modified: string\n    path: string\n    size: number\n    zarr: string | null // NOTE: Not sure if this type is correct\n\n    metadata: any\n  }\n  \nexport class Asset {\n\n    asset_id?: AssetBase['asset_id']\n    blob?: AssetBase['blob']\n    created?: AssetBase['created']\n    modified?: AssetBase['modified']\n    path?: AssetBase['path']\n    size?: AssetBase['size']\n    zarr?: AssetBase['zarr']\n    metadata?: AssetBase['metadata'] // WE ASSUME THIS IS ALREADY HERE, THOUGH IT ISN'T WITH POINTERS\n\n    #instance: InstanceType\n    #dandiset: string\n    \n    constructor(dandiset: string, info: string | AssetBase, instance: InstanceType = 'main') {\n      if (info && typeof info === 'object' && !(info instanceof String)) this.#set(info)\n      else this.asset_id = info as string\n      this.#instance = instance\n      this.#dandiset = dandiset\n    }\n  \n    #set = (o: any) => {\n        Object.assign(this, o)\n        this.asset_id = o.asset_id  // Sync the provided ID with the object\n    }\n  \n    async get (dandiset = this.#dandiset, id = this.asset_id, instance = this.#instance) {\n      this.#dandiset = dandiset\n      this.#instance = instance\n      this.asset_id = id\n\n      const asset = await getAsset(this.#dandiset, this.asset_id, this.#instance)\n      if (asset) Object.assign(this, asset)\n      return asset\n    }\n  \n  }\n\n\n\nexport const getAsset  = async (dandiset: string, id: string, options: Options = {}) => {\n    const url = getInfoURL(dandiset, options)\n    // const altBase = await getJSON(`${url}/assets/${id}`) // Only metadata\n    const base = await getJSON(`${url}/assets/${id}/info`)\n    return new Asset(dandiset, base, options.type)\n  }\n\n  export default Asset\n  ", "import { Asset, getAsset } from \"./Asset\"\nimport { Options } from \"./types\"\nimport { getBase, getInfo, getInfoURL, getInstance, getJSON, getLatestVersion, paginate } from \"./utils\"\n\ntype DandisetVersionInfo = {\n    asset_count: number,\n    created: string\n    modified: string\n    name: string\n    size: number\n    status: string\n    version: string | 'draft'\n  }\n\n  type DandisetBase = {\n    identifier: string\n    contact_person: string\n    created: string\n    embargo_status: string\n    modified: string\n    draft_version: DandisetVersionInfo\n    most_recent_published_version: DandisetVersionInfo\n  }\n\n\n  export class Dandiset {  \n  \n    // All provided synchronously from the constructor\n    identifier: DandisetBase['identifier']\n    contact_person?: DandisetBase['contact_person']\n    created?: DandisetBase['created']\n    embargo_status?: DandisetBase['embargo_status']\n    modified?: DandisetBase['modified']\n    draft_version?: DandisetBase['draft_version']\n    most_recent_published_version?: DandisetBase['most_recent_published_version']\n  \n    // Hidden properties fetched asynchronously\n    #base: any = {}\n    #info: any = {}\n    #assets: any = {}\n    #gotAllAssets = false\n\n    #options: Options = {}\n\n    constructor(info: DandisetBase | DandisetBase['identifier'] | undefined, options: Options) {\n\n        const isObject = info && typeof info === 'object' && !(info instanceof String)\n        if (isObject) this.#set(info)\n\n        this.identifier = isObject ? info.identifier : info as string // Sync the provided ID with the object\n        \n        this.#options = options\n      }\n  \n      #set = (o: any) => {\n        this.#base = o\n        Object.assign(this, o)\n        this.identifier = o.identifier  // Sync the provided ID with the object\n      }\n  \n      // GET Fetch Calls\n    async get (id = this.identifier) {\n\n        if (id !== this.identifier) {\n            this.identifier = id\n            this.#info = {}\n            this.#assets = {}\n\n            const base = await getBase(this.identifier, this.#options.type)\n            if (base) Object.assign(this, base)\n        }\n\n        return this.#base\n\n    }\n  \n    async getInfo(options: Options = this.#options) {\n      if (Object.keys(this.#info).length === 0) this.#info = await getInfo(this.identifier, options)\n      return this.#info\n    }\n  \n    async getAsset(id: string, options: Options = this.#options) {\n        if (!this.#assets[id]) this.#assets[id] = await getAsset(this.identifier, id, options)\n        return this.#assets[id]\n    }\n  \n    async getAssets(options: Options = this.#options) {\n        if (!this.#gotAllAssets) {\n        const assets = await getAssets(this.identifier, options)\n        console.log('Got assets', assets)\n\n        assets?.forEach((o: any) => this.#assets[o.asset_id] = o)\n        this.#gotAllAssets = true\n      }\n      return this.#assets\n    }\n  }\n\n\n\n  export const getAssetsUrl = (dandiset: string, options: Options = {}) => {\n    return `${getInfoURL(dandiset, options)}/assets`\n  }\n\nexport const getAssets = async (id: string, options: Options  = {}) => {\n    const version = options?.version ?? await getLatestVersion(id, options.type)\n    if (version) {\n      const url = `${getAssetsUrl(id, {...options, version})}`\n      const res = await getJSON(url)\n      return await Promise.all((await paginate(res)).map(async pointer => getAsset(id, pointer.asset_id, options)))\n    }\n  }\n  \n\n  export const getAll = async (options: Options) => {\n    const url = `https://${getInstance(options.type)}/api/dandisets`\n    const res = await getJSON(url)\n    const results = (await paginate(res)).map(o => new Dandiset(o, options))\n    return results\n  }\n\n  export const get = async (id: string, options: Options) => {\n    const info = await getBase(id, options.type)\n    if (info) return new Dandiset(info, options)\n    else return null\n  }\n  ", "import { get } from './Dandiset'\nimport { InstanceType, Options } from './types'\nimport { getURL } from './utils'\n\nexport * from './Dandiset'\nexport * from './Asset'\nexport * as utils from './utils'\n// const assetInfo = await dandi.getJSON(`${url}/${o.asset_id}/info`)\n// const option = document.createElement('option')\n// option.value = assetInfo.metadata.contentUrl[0]\n\n\ntype VersionMetadata = any\n\ntype APIOptions = {\n    token: string,\n    type?: InstanceType\n}\n\nexport class API {\n\n    token: APIOptions['token']\n    type: APIOptions['type']\n\n    authorized: boolean = false\n\n    constructor({ token, type = 'main' }: APIOptions) {\n\n       this.token = token\n       this.type = type \n\n    }\n\n    init = async () => {\n        await this.authorize()\n    }\n\n    #checkAuthorization = () => {\n        if (!this.authorized) throw new Error('API is not authorized. Please provide a valid token.')\n    }\n\n    get = async (id: string, options: Options = {}) => get(id, {...options, ...this})\n\n    create = async (name: string, metadata: VersionMetadata = {}, embargo: boolean = false) => {\n        \n        this.#checkAuthorization()\n\n        const url = getURL(`dandisets/?embargo=${embargo}`, this.type)\n        const data = JSON.stringify({ name, metadata })\n\n        const created = await fetch(url, {\n            method: 'POST',\n            headers: this.#getBaseHeaders(),\n            body: data,\n        })\n        .then(response => response.json()) // NOTE: Getting a net::ERR_FAILED 200 (OK) because of a CORS issue (even when successful)\n    \n        return created\n    }\n\n    #getBaseHeaders = (token = this.token) => {\n        return {\n            \"Authorization\": `token ${token}`,\n            'accept': 'application/json',\n            'Content-Type': 'application/json',\n        }\n    }\n    \n    authorize = async (token: string = this.token) => {\n\n        await fetch(getURL('auth/token', this.type), { headers: this.#getBaseHeaders(token) })\n        .catch(e => {\n            this.authorized = false\n            throw e\n        })\n\n        this.token = token\n        this.authorized = true\n    }\n\n\n}"],
  "mappings": "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",
  "names": []
}
